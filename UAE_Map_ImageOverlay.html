<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>خريطة الإمارات (خلفية صورة ملوّنة) + صور وصوت</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
  <style>
    html, body, #map { height: 100%; margin: 0; }
    .title-bar {
      position: absolute; top: 10px; right: 10px; z-index: 1000;
      background: rgba(255,255,255,0.95); padding: 10px 12px; border-radius: 12px;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans Arabic", "Tajawal", sans-serif;
      box-shadow: 0 2px 10px rgba(0,0,0,0.15); max-width: 420px;
    }
    .title-bar h1 { font-size: 16px; margin: 0 0 6px; }
    .title-bar .hint { font-size: 13px; opacity: .85; }
    .list {
      position:absolute; bottom: 10px; right: 10px; z-index:1000;
      background: rgba(255,255,255,0.95); padding: 8px 10px; border-radius:12px;
      max-width: 300px; max-height: 46vh; overflow:auto;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans Arabic", "Tajawal", sans-serif;
      box-shadow: 0 2px 10px rgba(0,0,0,0.15);
    }
    .list b { display:block; margin-bottom:6px; }
    .list button {
      display:block; width:100%; margin:4px 0; padding:8px 10px; border-radius:10px;
      border:1px solid #ddd; background:#fff; cursor:pointer; text-align:right;
    }
    .list button:hover { background:#f4f4f4; }
    .popup img { max-width: 240px; border-radius: 10px; display:block; margin-bottom:8px; }
    .popup audio { width: 100%; }
    .note { font-size:12px; opacity:.8; margin-top:6px; }
  </style>
</head>
<body>
  <div id="map"></div>
  <div class="title-bar">
    <h1>الخريطة الملوّنة للإمارات – اضغط على أيقونة الإمارة</h1>
    <div class="hint">
      • ضَع/ي ملف الصورة باسم <code>uae_map.png</code> في نفس المجلد مع هذا الملف.<br>
      • يمكن تعديل حدود الصورة (السطر المعلّق في الكود) إذا احتجتِ مواءمة أدق.<br>
      • تبقى البطاقات تعرض <b>صورة</b> و<b>صوت</b> لكل إمارة إذا توفّرت الملفات: <code>abudhabi.jpg/mp3</code> … <code>fujairah.jpg/mp3</code>.
    </div>
  </div>
  <div class="list" id="list"></div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
  <script>
    // بيانات الإمارات (إحداثيات تقريبية لمواضع النقاط)
    const emirates = [
      { slug: 'abudhabi', name: 'أبوظبي (العاصمة)', desc: 'عاصمة دولة الإمارات العربية المتحدة.', lat: 24.4539, lon: 54.3773 },
      { slug: 'dubai', name: 'دبي', desc: 'مدينة حديثة ومعروفة بناطحات السحاب.', lat: 25.2048, lon: 55.2708 },
      { slug: 'sharjah', name: 'الشارقة', desc: 'إمارة الثقافة والمتاحف.', lat: 25.3463, lon: 55.4209 },
      { slug: 'ajman', name: 'عجمان', desc: 'إمارة صغيرة على الساحل.', lat: 25.4052, lon: 55.5136 },
      { slug: 'uaq', name: 'أم القيوين', desc: 'هادئة بإطلالة بحرية.', lat: 25.5863, lon: 55.5760 },
      { slug: 'rak', name: 'رأس الخيمة', desc: 'جبال عالية وطبيعة جميلة.', lat: 25.8007, lon: 55.9762 },
      { slug: 'fujairah', name: 'الفجيرة', desc: 'على بحر عُمان بسواحل رائعة.', lat: 25.1288, lon: 56.3265 }
    ];

    // إنشاء الخريطة
    const map = L.map('map', { zoomControl: true });
    
    // حدود تقريبية للإمارات لضبط الصورة (الزاوية الجنوبية الغربية والزاوية الشمالية الشرقية)
    // عدّلي هذه القيم إذا احتجتِ مواءمة أدق مع نقاطك.
    const imageBounds = [[22.5, 51.5], [26.6, 56.7]]; // [lat,lng] SW , [lat,lng] NE
    const overlay = L.imageOverlay('uae_map.png', imageBounds).addTo(map);
    map.fitBounds(imageBounds);

    const group = L.featureGroup().addTo(map);

    function makePopup(e) {
      const imgTag = `<img src="${e.slug}.jpg" alt="صورة ${e.name}" onerror="this.style.display='none'">`;
      const audioTag = `<audio controls src="${e.slug}.mp3" onerror="this.outerHTML='<div class=note>أضيفي ملف الصوت: ${e.slug}.mp3</div>'"></audio>`;
      return `<div class="popup"><b>${e.name}</b><br>${e.desc}<br>${imgTag}${audioTag}</div>`;
    }

    emirates.forEach(e => {
      const m = L.circleMarker([e.lat, e.lon], { radius:10, fillOpacity:0.95, color:'#1f2937', weight:1 })
        .addTo(group)
        .bindPopup(makePopup(e));
      m.on('click', () => m.openPopup());
    });

    // قائمة الانتقال السريع
    const list = document.getElementById('list');
    list.innerHTML = "<b>انتقلي مباشرة إلى الإمارة:</b>" +
      emirates.map((e, i) => `<button data-idx='${i}'>${e.name}</button>`).join("");
    list.addEventListener('click', (ev) => {
      const btn = ev.target.closest('button'); if (!btn) return;
      const i = +btn.dataset.idx, e = emirates[i];
      const latlng = [e.lat, e.lon];
      map.flyTo(latlng, 10, { duration: 1.2 });
      setTimeout(() => {
        let nearest = null, dmin = 1e9;
        group.eachLayer(m => {
          const ll = m.getLatLng();
          const d = Math.hypot(ll.lat - latlng[0], ll.lng - latlng[1]);
          if (d < dmin) { dmin = d; nearest = m; }
        });
        if (nearest) nearest.openPopup();
      }, 1200);
    });
  </script>
</body>
</html>
